(function($){window.wshop_jsapi={fast_shopping:function(dom_id,request){if($(dom_id).attr('data-loading')){return}var pre_text=$(dom_id).text();$.ajax({url:wshop_jsapi_params.ajax_url,type:'post',timeout:60*1000,async:true,cache:false,data:data,beforeSend:function(){$(dom_id).attr('data-loading','true').text(wshop_jsapi_params.msg_processing)},dataType:'json',success:function(m){if(m.errcode!=0){if(m.errcode==501){location.href=wshop_jsapi_params.wp_login_url.replace('#location#',request.location);return}alert(m.errmsg);$(dom_id).removeAttr('data-loading').text(pre_text);return}location.href=m.data},error:function(e){console.warn(e.responseText);alert(wshop_jsapi_params.msg_err_500);$(dom_id).removeAttr('data-loading').text(pre_text)}})},shopping:function(dom_id,request){window.wshop_jsapi.inner_temp={dom_id:dom_id,request:request};$('.wshop-pay-button').hide();$('#wshop-modal-payment-gateways .xh-button-box .loading').hide();$('#wshop-modal-payment-gateways').css({'display':'block'});window.wshop_jsapi.inner.on_button_ui_resize()},shopping_1:function(dom_id,request){window.wshop_jsapi.inner_temp={dom_id:dom_id,request:request};var pre_txt=$(dom_id).text();$(dom_id).attr('disabled','disabled').addClass('data-loading').text(wshop_jsapi_params.msg_processing);if($(window.wshop_jsapi.inner_temp.dom_id).attr('data-loading')){return}$.ajax({url:wshop_jsapi_params.ajax_url,type:'post',timeout:60*1000,async:true,cache:false,data:request,dataType:'json',success:function(m){$(dom_id).removeAttr('disabled').removeClass('data-loading').text(pre_txt);if(m.errcode!=0){if(m.errcode==501){location.href=wshop_jsapi_params.wp_login_url.replace('#location#',window.wshop_jsapi.inner_temp.request.location);return}alert(m.errmsg);return}window.wshop_jsapi.inner.loop=m.data.url_query;window.wshop_jsapi.inner.loop_query_order();$('.wshop-pay-button').hide();$('#wshop-modal-payment-gateways-1-qrcode').attr('src',m.data.qrcode_url);$('#wshop-modal-payment-gateways-1-amount').html(m.data.price_html);$('#shop-modal-payment-gateways-payment-method').css('color','#333').html($('#shop-modal-payment-gateways-payment-method-pre').html());$('#wshop-modal-payment-gateways-1').css({'display':'block'});window.wshop_jsapi.inner.on_qrcode_resize()},error:function(e){console.warn(e.responseText);alert(wshop_jsapi_params.msg_err_500);$(dom_id).removeAttr('disabled').removeClass('data-loading').text(pre_txt)}})}};window.wshop_jsapi.inner={loop:false,on_button_ui_resize:function(){var $ul=$('#wshop-modal-payment-gateways .xh-button-box');var $window=jQuery(window);if($window.width()>450){$ul.css({top:((document.documentElement.clientHeight-$ul.height())/2)+"px",left:((document.documentElement.clientWidth-$ul.width())/2)+"px"})}else{$ul.css({top:'',left:''})}},on_qrcode_resize:function(){var $ul=$('#wshop-modal-payment-gateways-1 div.mod-ct');var $window=jQuery(window);if($window.width()>450){$ul.css({top:((document.documentElement.clientHeight-415)/2)+"px",left:((document.documentElement.clientWidth-450)/2)+"px"})}else{$ul.css({top:'',left:''})}},loop_query_order:function(){if(!window.wshop_jsapi.inner.loop){return}setTimeout(function(){$.ajax({url:window.wshop_jsapi.inner.loop,type:'post',timeout:60*1000,async:true,cache:false,dataType:'json',success:function(m){if(m.errcode!=0){window.wshop_jsapi.inner.loop_query_order();return}if(m.data.payment_method!=null){$('#shop-modal-payment-gateways-payment-method').html('您正在使用 '+m.data.payment_method+'进行支付').css('color','green')}if(m.data.paid){$('#shop-modal-payment-gateways-payment-method').html('您已使用'+m.data.payment_method+'支付成功，跳转中...').css('color','green');location.href=m.data.received_url;return}else{window.wshop_jsapi.inner.loop_query_order();return}},error:function(e){console.warn(e.responseText);window.wshop_jsapi.inner.loop_query_order();return}})},3000)}};$(function(){$(window).resize(function(){window.wshop_jsapi.inner.on_button_ui_resize();window.wshop_jsapi.inner.on_qrcode_resize()});$('#wshop-modal-payment-gateways .cover,#wshop-modal-payment-gateways .xh-button-box .close').click(function(){$('#wshop-modal-payment-gateways').hide();$('#wshop-modal-payment-gateways-1').hide();window.wshop_jsapi.inner.loop=null});$('#wshop-modal-payment-gateways-1 .cover,#wshop-modal-payment-gateways-1 .mod-ct .xh-close').click(function(){$('#wshop-modal-payment-gateways').hide();$('#wshop-modal-payment-gateways-1').hide();window.wshop_jsapi.inner.loop=null});$('#wshop-modal-payment-gateways .xh-button-box .xh-item').click(function(){if(!window.wshop_jsapi.inner_temp){return}var data=window.wshop_jsapi.inner_temp.request;data.payment_method=$(this).attr('data-id');if($(window.wshop_jsapi.inner_temp.dom_id).attr('data-loading')){return}$.ajax({url:wshop_jsapi_params.ajax_url,type:'post',timeout:60*1000,async:true,cache:false,data:data,beforeSend:function(){$(window.wshop_jsapi.inner_temp.dom_id).attr('data-loading','true');$('#wshop-modal-payment-gateways .xh-button-box .loading').show()},dataType:'json',success:function(m){if(m.errcode!=0){if(m.errcode==501){location.href=wshop_jsapi_params.wp_login_url.replace('#location#',window.wshop_jsapi.inner_temp.request.location);return}alert(m.errmsg);$(window.wshop_jsapi.inner_temp.dom_id).removeAttr('data-loading');$('#wshop-modal-payment-gateways .xh-button-box .loading').hide();return}location.href=m.data},error:function(e){console.warn(e.responseText);alert(wshop_jsapi_params.msg_err_500);$(window.wshop_jsapi.inner_temp.dom_id).removeAttr('data-loading');$('#wshop-modal-payment-gateways .xh-button-box .loading').hide()}})})})})(jQuery);